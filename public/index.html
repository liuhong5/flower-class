<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>云端花园管理系统</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
</head>
<body>
    <!-- 登录界面 -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <i class="fas fa-seedling"></i>
                <h1>云端花园管理系统</h1>
            </div>
            <form id="loginForm" class="login-form">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="username" placeholder="用户名" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="password" placeholder="密码" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    登录
                </button>
                <button type="button" id="registerBtn" class="register-btn">
                    <i class="fas fa-user-plus"></i>
                    注册新用户
                </button>
            </form>
        </div>
    </div>

    <!-- 主界面 -->
    <div id="mainContainer" class="main-container" style="display: none;">
        <!-- 顶部导航 -->
        <nav class="navbar">
            <div class="nav-brand">
                <i class="fas fa-seedling"></i>
                <span>云端花园</span>
            </div>
            <div class="nav-user">
                <button id="mobileMenuBtn" class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <button id="helpBtn" class="theme-toggle" onclick="window.open('help.html', '_blank')" title="使用说明">
                    <i class="fas fa-question-circle"></i>
                </button>
                <button id="changePasswordBtn" class="theme-toggle" title="修改密码">
                    <i class="fas fa-key"></i>
                </button>
                <button id="themeToggle" class="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="exportBtn" class="export-btn">
                    <i class="fas fa-download"></i>
                    导出
                </button>
                <span id="userInfo"></span>
                <button id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    退出
                </button>
            </div>
        </nav>

        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-menu">
                <div class="menu-item active" data-tab="classes">
                    <i class="fas fa-school"></i>
                    <span>班级管理</span>
                </div>
                <div class="menu-item" data-tab="flowers">
                    <i class="fas fa-flower"></i>
                    <span>花朵管理</span>
                </div>
                <div class="menu-item" data-tab="gardens">
                    <i class="fas fa-leaf"></i>
                    <span>花田管理</span>
                </div>
                <div class="menu-item" data-tab="rankings">
                    <i class="fas fa-trophy"></i>
                    <span>排行榜</span>
                </div>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 班级管理 -->
            <div id="classesTab" class="tab-content active">
                <div class="content-header">
                    <h2><i class="fas fa-school"></i> 班级管理</h2>
                    <button id="addClassBtn" class="add-btn editor-only">
                        <i class="fas fa-plus"></i>
                        添加班级
                    </button>
                </div>
                <div class="class-tip">
                    <i class="fas fa-info-circle"></i>
                    <span>点击班级卡片或“进入”按钮可以查看该班级的花朵、花田和排行榜</span>
                </div>
                <div id="classesList" class="cards-grid"></div>
            </div>

            <!-- 花朵管理 -->
            <div id="flowersTab" class="tab-content">
                <div class="content-header">
                    <h2><i class="fas fa-flower"></i> 花朵管理</h2>
                    <div class="header-controls">
                        <select id="classSelect" class="class-select">
                            <option value="">选择班级</option>
                        </select>
                        <button id="addFlowerBtn" class="add-btn editor-only">
                            <i class="fas fa-plus"></i>
                            添加花朵
                        </button>
                    </div>
                </div>
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="flowerSearch" class="search-box" placeholder="搜索花朵名称...">
                </div>
                <div id="flowerBatchToolbar" class="batch-toolbar">
                    <div class="batch-info">
                        已选择 <span id="selectedFlowerCount">0</span> 朵花
                    </div>
                    <div class="batch-actions">
                        <button class="batch-btn batch-water" onclick="app.batchWaterFlowers()">
                            <i class="fas fa-tint"></i> 批量浇水
                        </button>
                        <button class="batch-btn batch-cancel" onclick="app.cancelBatchSelection()">
                            <i class="fas fa-times"></i> 取消选择
                        </button>
                    </div>
                </div>
                <div id="flowersList" class="cards-grid"></div>
                <div id="flowerPagination" class="pagination"></div>
            </div>

            <!-- 花田管理 -->
            <div id="gardensTab" class="tab-content">
                <div class="content-header">
                    <h2><i class="fas fa-leaf"></i> 花田管理</h2>
                    <div class="header-controls">
                        <select id="gardenClassSelect" class="class-select">
                            <option value="">选择班级</option>
                        </select>
                        <button id="addGardenBtn" class="add-btn editor-only">
                            <i class="fas fa-plus"></i>
                            添加花田
                        </button>
                    </div>
                </div>
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="gardenSearch" class="search-box" placeholder="搜索花田名称...">
                </div>
                <div id="gardenBatchToolbar" class="batch-toolbar">
                    <div class="batch-info">
                        已选择 <span id="selectedGardenCount">0</span> 个花田
                    </div>
                    <div class="batch-actions">
                        <button class="batch-btn batch-score" onclick="app.showBatchScoreModal()">
                            <i class="fas fa-plus"></i> 批量加分
                        </button>
                        <button class="batch-btn batch-cancel" onclick="app.cancelBatchSelection()">
                            <i class="fas fa-times"></i> 取消选择
                        </button>
                    </div>
                </div>
                <div id="gardensList" class="cards-grid"></div>
                <div id="gardenPagination" class="pagination"></div>
                
                <!-- 花田详情模态框 -->
                <div id="gardenDetailModal" class="modal">
                    <div class="modal-content garden-detail">
                        <span class="close" onclick="app.closeGardenDetail()">&times;</span>
                        <div id="gardenDetailBody"></div>
                    </div>
                </div>
            </div>

            <!-- 排行榜 -->
            <div id="rankingsTab" class="tab-content">
                <div class="content-header">
                    <h2><i class="fas fa-trophy"></i> 排行榜</h2>
                    <div class="header-controls">
                        <select id="rankingClassSelect" class="class-select">
                            <option value="">选择班级查看排行榜</option>
                        </select>
                    </div>
                </div>
                <div class="stats-overview">
                    <div id="realTimeStats" class="real-time-stats"></div>
                    <div class="chart-controls">
                        <button onclick="app.loadAdvancedCharts()" class="chart-btn">📊 加载图表</button>
                        <button onclick="app.printRankings()" class="print-btn">🖨️ 打印</button>
                        <button onclick="app.toggleFullscreen()" class="fullscreen-btn">🔍 全屏</button>
                    </div>
                </div>
                <div class="charts-grid">
                    <div class="chart-container">
                        <h4>柱状图</h4>
                        <canvas id="statsChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4>饼图</h4>
                        <canvas id="pieChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4>雷达图</h4>
                        <canvas id="radarChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h4>趋势图</h4>
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
                <div id="rankingsContent" class="rankings-container" style="display: none;">
                    <div class="ranking-section">
                        <h3><i class="fas fa-flower"></i> 花朵排行榜</h3>
                        <div id="flowerRankings" class="ranking-list"></div>
                    </div>
                    <div class="ranking-section">
                        <h3><i class="fas fa-leaf"></i> 花田排行榜</h3>
                        <div id="gardenRankings" class="ranking-list"></div>
                    </div>
                </div>
                <div id="historyContainer" class="history-container" style="display: none;">
                    <h3>操作历史记录</h3>
                    <div id="historyList"></div>
                </div>
                <div id="noClassSelected" class="no-selection">
                    <i class="fas fa-info-circle"></i>
                    <p>请选择一个班级来查看该班级的排行榜</p>
                </div>
            </div>
        </main>
    </div>

    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- 浇水动画 -->
    <div id="waterAnimation" class="water-animation">
        <div class="water-drop">💧</div>
        <div class="growth-effect">🌱</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="config.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="script.js"></script>
    <script>
        // 初始化PWA和高级功能
        document.addEventListener('DOMContentLoaded', () => {
            if (window.app) {
                app.initPWA();
                app.initNotificationSystem();
                app.initOfflineSupport();
            }
        });
    </script>
</body>
</html>